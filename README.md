# Markoshka

Небольшая утилита для Raspberry Pi 2W, которая выводит дружеские фразы на дисплей покупателя (20x2). Включённый по автозапуску скрипт показывает приветствие, после чего каждые 5 секунд переключает фразу.

## Возможности
- Три режима показа:
  1. **Подряд** — категории и фразы идут последовательно по кругу.
  2. **Рандом** — выбирается любая фраза из любых категорий.
  3. **По разделу** — стартуем с выбранной категории, показываем её фразы, затем следующие категории по кругу.
- Управление одной кнопкой (GPIO17, `pull_up=True`):
  - Короткое нажатие: переключить режим (Подряд → Рандом → По разделу → ...).
  - Долгое нажатие (1.2+ с): выбрать следующую категорию и сразу перейти в режим «По разделу».
- Приветственное сообщение прокручивается **вверх** построчно на двух строках (20 символов каждая) без посимвольного бегущего текста; рабочие фразы показываются целиком на двух строках, помещаясь в 20 символов.

## Текстовое оформление
- Приветствие длинное, поэтому оно выводится как бегущая строка **вверх** на обеих строках дисплея: каждое предложение прокручивается целиком, подъезжая снизу, а не посимвольно влево. Так текст занимает две строки и остаётся читаемым.
- Рабочие фразы подбирайте так, чтобы каждая целиком помещалась в 20 символов (2 строки по 20 символов при необходимости). В поставке есть 10 тестовых фраз в 9 категориях; их легко заменить на полный список в `markoshka/phrases.py`.

## Запуск
```bash
pip install -r requirements.txt  # на Pi
python main.py
```
При отсутствии `gpiozero` программа работает в консоли: фразы печатаются в терминал, кнопку имитировать не нужно (режим остаётся «Подряд»).

### Автозапуск через systemd
Создайте сервис `/etc/systemd/system/markoshka.service`:
```
[Unit]
Description=Markoshka display loop
After=network.target

[Service]
ExecStart=/usr/bin/python /home/pi/Markoshka/main.py
WorkingDirectory=/home/pi/Markoshka
Restart=always
User=pi

[Install]
WantedBy=multi-user.target
```
Затем выполните:
```bash
sudo systemctl daemon-reload
sudo systemctl enable --now markoshka.service
```

## Настройка под дисплей
В проект добавлен драйвер для PD2800 (20x2, I2C-бэкпак PCF8574). При старте пытается использовать его автоматически; если нет библиотеки/шины — падает в консольный режим.

1) Включите I2C на Raspberry Pi: `sudo raspi-config nonint do_i2c 0` (или через меню raspi-config).
2) Поставьте зависимости на Pi: `sudo apt install -y python3-pip python3-rpi.gpio i2c-tools && pip install RPLCD gpiozero`.
3) Подключите PD2800 (I2C-модуль):
   - VCC → 5V, GND → GND
   - SDA → GPIO2 (SDA1), SCL → GPIO3 (SCL1)
   - Подсветка: A → 5V (можно через резистор), K → GND
4) Узнайте адрес адаптера: `sudo i2cdetect -y 1` (обычно 0x27 или 0x3F). Если не 0x27, запустите с `MARKOSHKALCD_ADDR=0x3F python main.py`.

Если хотите явный драйвер в коде, передайте `driver=PD2800DisplayDriver(address=0x27)` в `MarkoshkaApp()`. Console-путь оставлен для отладки без железа.
